<!DOCTYPE html>
<html>
  <head>
    <title>AR.js QRCode Marker</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      <a-marker-camera type="barcode"></a-marker-camera>
      <a-box position="0 0.5 0" material="color: blue;"></a-box>
      <a-text position="0 -1 0" id="custom-text"></a-text>
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Espera até que a cena seja carregada
      document.querySelector('a-scene').addEventListener('loaded', function () {
        // Obtém a referência ao elemento de texto
        var textElement = document.querySelector('#custom-text');

        // Obtém o elemento de vídeo da câmera
        var video = document.querySelector('video');

        // Função para processar o quadro do vídeo e decodificar o QR Code
        function processVideoFrame() {
          var canvas = document.createElement('canvas');
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          var context = canvas.getContext('2d');
          context.drawImage(video, 0, 0, canvas.width, canvas.height);
          var imageData = context.getImageData(0, 0, canvas.width, canvas.height);
          var code = jsQR(imageData.data, imageData.width, imageData.height);
          if (code) {
            // Atualiza o texto com o valor do QR Code
            textElement.setAttribute('value', code.data);
          }

          // Continua processando os quadros do vídeo
          requestAnimationFrame(processVideoFrame);
        }

        // Inicia o processamento dos quadros do vídeo
        processVideoFrame();
      });
    </script>
  </body>
</html>