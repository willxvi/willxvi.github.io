<!DOCTYPE html>
<html>
<head>
  <title>Ler QR Code com a câmera do navegador e AR.js</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js/aframe/build/aframe-ar.js"></script>
  <script src="https://cdn.rawgit.com/cozmo/jsQR/master/dist/jsQR.js"></script>
</head>
<body>
  <h1>Ler QR Code com a câmera do navegador e AR.js</h1>
  <a-scene embedded arjs="sourceType: webcam;">
    <a-marker preset="hiro">
      <a-entity position="0 0 0" barcode-detector></a-entity>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>
  <script>
    AFRAME.registerComponent('barcode-detector', {
      init: function () {
        this.canvas = document.createElement('canvas');
        this.context = this.canvas.getContext('2d');
        this.scanning = false;
        this.textEntity = document.createElement('a-entity');
        this.el.appendChild(this.textEntity);
      },
      tick: function () {
        if (this.el.object3D.visible && !this.scanning) {
          this.scanning = true;
          const width = this.el.object3D.visibleWidth;
          const height = this.el.object3D.visibleHeight;
          this.canvas.width = width;
          this.canvas.height = height;
          this.context.drawImage(this.el.sceneEl.canvas, 0, 0, width, height);
          const imageData = this.context.getImageData(0, 0, width, height);
          const code = jsQR(imageData.data, imageData.width, imageData.height, {
            inversionAttempts: 'dontInvert',
          });
          if (code) {
            this.textEntity.setAttribute('text', {
              value: code.data,
              align: 'center',
              wrapCount: 20,
              color: 'black',
              width: 2
            });
          } else {
            this.textEntity.removeAttribute('text');
          }
          this.scanning = false;
        }
      }
    });
  </script>
</body>
</html>